#!/bin/bash

# Check if already installed.
if [ -d /home/i2p/i2p ]; then
  echo "ERROR: I2P HAS ALREADY BEEN INSTALLED"
  exit 1
fi

# Check if installer exists.
if ! [ -f /home/i2p/i2pinstall.jar ]; then
  echo "ERROR: I2P INSTALLER HAS NOT BEEN DOWNLOADED"
  exit 1
fi

# Ensure the installer proxies its connections through Tor.
export JAVA_OPTIONS="$JAVA_OPTIONS -DsocksProxyHost=localhost -DsocksProxyPort=9043"

# Run the installer.
java -jar /home/i2p/i2pinstall.jar

# Delete installer.
rm -f /home/i2p/i2pinstall.jar /home/i2p/i2pinstall.jar.sig

# Check if I2P has been installed correctly.
if [ -d /home/i2p/i2p ]; then
  echo "I2P HAS BEEN INSTALLED"
  
  # Create a statefile so the browser script knows I2P has been installed.
  touch /tmp/i2p_installed
  chmod 644 /tmp/i2p_installed
else
  echo "ERROR: I2P HAS NOT BEEN INSTALLED"
fi

# Start I2P.
/home/i2p/i2p/i2prouter start
